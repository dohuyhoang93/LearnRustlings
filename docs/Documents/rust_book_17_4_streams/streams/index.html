
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive notes on understanding Rustlings concepts and exercises">
      
      
      
        <link rel="canonical" href="https://dohuyhoang93.github.io/LearnRustlings/Documents/rust_book_17_4_streams/streams/">
      
      
        <link rel="prev" href="../../19_smart_pointers/cow1/">
      
      
      
      <link rel="icon" href="../../../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Streams trong Rust và cách sử dụng. - Rustlings Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CTerminus:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Terminus"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ma-chuong-trinh-vi-du" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Rustlings Documentation" class="md-header__button md-logo" aria-label="Rustlings Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rustlings Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Streams trong Rust và cách sử dụng.
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../vi/" hreflang="vi" class="md-select__link">
              Vietnamese
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dohuyhoang93/LearnRustlings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../19_smart_pointers/cow1/" class="md-tabs__link">
          
  
  
  Documents

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Rustlings Documentation" class="md-nav__button md-logo" aria-label="Rustlings Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    Rustlings Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dohuyhoang93/LearnRustlings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Documents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    19 smart pointers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            19 smart pointers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../19_smart_pointers/cow1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cow (Clone-on-Write) trong Rust
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Rust book 17 4 streams
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Rust book 17 4 streams
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Streams trong Rust và cách sử dụng.
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Streams trong Rust và cách sử dụng.
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ma-chuong-trinh-vi-du" class="md-nav__link">
    <span class="md-ellipsis">
      Mã chương trình ví dụ:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ly-thuyet-nen-tang" class="md-nav__link">
    <span class="md-ellipsis">
      Lý thuyết nền tảng:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-hop-nhat-hoat-ong-cac-luong-stream" class="md-nav__link">
    <span class="md-ellipsis">
      merge (hợp nhất) hoạt động các luồng stream.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merge (hợp nhất) hoạt động các luồng stream.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-luon-lang-nghe-ca-hai-nguon-cung-luc" class="md-nav__link">
    <span class="md-ellipsis">
      1. Luôn lắng nghe cả hai nguồn cùng lúc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ai-en-truoc-phuc-vu-truoc-first-come-first-served" class="md-nav__link">
    <span class="md-ellipsis">
      2. "Ai đến trước, phục vụ trước" (First-Come, First-Served)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cung-loai-du-lieu" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cùng loại dữ liệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-khi-nao-thi-ket-thuc" class="md-nav__link">
    <span class="md-ellipsis">
      4. Khi nào thì kết thúc?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spawn_task-trong-ma-la-gi" class="md-nav__link">
    <span class="md-ellipsis">
      spawn_task trong mã là gì?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giai-thich-ky-hon-ve-impl-stream-va-receiverstream" class="md-nav__link">
    <span class="md-ellipsis">
      Giải thích kỹ hơn về impl Stream và ReceiverStream
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Streams trong Rust và cách sử dụng.</h1>

<h2 id="ma-chuong-trinh-vi-du">Mã chương trình ví dụ:<a class="headerlink" href="#ma-chuong-trinh-vi-du" title="Permanent link">&para;</a></h2>
<p>Example code:</p>
<div class="language-rust highlight"><span class="filename">Rust</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::{</span><span class="n">pin</span><span class="p">::</span><span class="n">pin</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">::</span><span class="n">Duration</span><span class="p">};</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">use</span><span class="w"> </span><span class="n">trpl</span><span class="p">::{</span><span class="n">ReceiverStream</span><span class="p">,</span><span class="w"> </span><span class="n">Stream</span><span class="p">,</span><span class="w"> </span><span class="n">StreamExt</span><span class="p">};</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">fn</span><span class="w"> </span><span class="nf">get_messages</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trpl</span><span class="p">::</span><span class="n">channel</span><span class="p">();</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">spawn_task</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;j&quot;</span><span class="p">];</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">time_to_sleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">            </span><span class="n">trpl</span><span class="p">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="n">time_to_sleep</span><span class="p">)).</span><span class="k">await</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">send_error</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Message: &#39;{message}&#39;&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><a href="#__codelineno-0-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">                </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">&quot;Cannot send message &#39;{message}&#39;: {send_error}&quot;</span><span class="p">);</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><a href="#__codelineno-0-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><a href="#__codelineno-0-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><a href="#__codelineno-0-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><a href="#__codelineno-0-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><a href="#__codelineno-0-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><a href="#__codelineno-0-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="n">ReceiverStream</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><a href="#__codelineno-0-20"><span class="linenos" data-linenos="20 "></span></a><span class="p">}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><a href="#__codelineno-0-21"><span class="linenos" data-linenos="21 "></span></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><a href="#__codelineno-0-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">fn</span><span class="w"> </span><span class="nf">get_intervals</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><a href="#__codelineno-0-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trpl</span><span class="p">::</span><span class="n">channel</span><span class="p">();</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><a href="#__codelineno-0-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><a href="#__codelineno-0-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">spawn_task</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><a href="#__codelineno-0-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><a href="#__codelineno-0-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">        </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><a href="#__codelineno-0-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">            </span><span class="n">trpl</span><span class="p">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="k">await</span><span class="p">;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><a href="#__codelineno-0-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">            </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><a href="#__codelineno-0-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">send_error</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><a href="#__codelineno-0-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">                </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">&quot;Could not send interval {count}: {send_error}&quot;</span><span class="p">);</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><a href="#__codelineno-0-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><a href="#__codelineno-0-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><a href="#__codelineno-0-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><a href="#__codelineno-0-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><a href="#__codelineno-0-36"><span class="linenos" data-linenos="36 "></span></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><a href="#__codelineno-0-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span><span class="n">ReceiverStream</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><a href="#__codelineno-0-38"><span class="linenos" data-linenos="38 "></span></a><span class="p">}</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><a href="#__codelineno-0-39"><span class="linenos" data-linenos="39 "></span></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><a href="#__codelineno-0-40"><span class="linenos" data-linenos="40 "></span></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><a href="#__codelineno-0-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">run</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><a href="#__codelineno-0-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;==========block1===========&quot;</span><span class="p">);</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><a href="#__codelineno-0-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><a href="#__codelineno-0-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">n</span><span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><a href="#__codelineno-0-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trpl</span><span class="p">::</span><span class="n">stream_from_iter</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><a href="#__codelineno-0-46"><span class="linenos" data-linenos="46 "></span></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><a href="#__codelineno-0-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><a href="#__codelineno-0-48"><span class="linenos" data-linenos="48 "></span></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><a href="#__codelineno-0-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filtered</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><a href="#__codelineno-0-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;The value was: {value}&quot;</span><span class="p">);</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><a href="#__codelineno-0-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><a href="#__codelineno-0-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><a href="#__codelineno-0-53"><span class="linenos" data-linenos="53 "></span></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><a href="#__codelineno-0-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">run</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><a href="#__codelineno-0-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;==========block2===========&quot;</span><span class="p">);</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><a href="#__codelineno-0-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_messages</span><span class="p">();</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><a href="#__codelineno-0-57"><span class="linenos" data-linenos="57 "></span></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><a href="#__codelineno-0-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><a href="#__codelineno-0-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{message}&quot;</span><span class="p">);</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><a href="#__codelineno-0-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><a href="#__codelineno-0-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><a href="#__codelineno-0-62"><span class="linenos" data-linenos="62 "></span></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><a href="#__codelineno-0-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">run</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><a href="#__codelineno-0-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;==========block3===========&quot;</span><span class="p">);</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><a href="#__codelineno-0-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pin</span><span class="o">!</span><span class="p">(</span><span class="n">get_messages</span><span class="p">().</span><span class="n">timeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">200</span><span class="p">)));</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><a href="#__codelineno-0-66"><span class="linenos" data-linenos="66 "></span></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><a href="#__codelineno-0-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><a href="#__codelineno-0-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><a href="#__codelineno-0-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">                </span><span class="nb">Ok</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{message}&quot;</span><span class="p">),</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><a href="#__codelineno-0-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">                </span><span class="nb">Err</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">&quot;Problem: {reason:?}&quot;</span><span class="p">),</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><a href="#__codelineno-0-71"><span class="linenos" data-linenos="71 "></span></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><a href="#__codelineno-0-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><a href="#__codelineno-0-73"><span class="linenos" data-linenos="73 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><a href="#__codelineno-0-74"><span class="linenos" data-linenos="74 "></span></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><a href="#__codelineno-0-75"><span class="linenos" data-linenos="75 "></span></a><span class="w">    </span><span class="n">trpl</span><span class="p">::</span><span class="n">run</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><a href="#__codelineno-0-76"><span class="linenos" data-linenos="76 "></span></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;==========block4===========&quot;</span><span class="p">);</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><a href="#__codelineno-0-77"><span class="linenos" data-linenos="77 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_messages</span><span class="p">().</span><span class="n">timeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><a href="#__codelineno-0-78"><span class="linenos" data-linenos="78 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">intervals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_intervals</span><span class="p">()</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><a href="#__codelineno-0-79"><span class="linenos" data-linenos="79 "></span></a><span class="w">            </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">count</span><span class="o">|</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Interval: {count}&quot;</span><span class="p">))</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><a href="#__codelineno-0-80"><span class="linenos" data-linenos="80 "></span></a><span class="w">            </span><span class="p">.</span><span class="n">throttle</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><a href="#__codelineno-0-81"><span class="linenos" data-linenos="81 "></span></a><span class="w">            </span><span class="p">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_secs</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><a href="#__codelineno-0-82"><span class="linenos" data-linenos="82 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">merged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">intervals</span><span class="p">).</span><span class="n">take</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><a href="#__codelineno-0-83"><span class="linenos" data-linenos="83 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pin</span><span class="o">!</span><span class="p">(</span><span class="n">merged</span><span class="p">);</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><a href="#__codelineno-0-84"><span class="linenos" data-linenos="84 "></span></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><a href="#__codelineno-0-85"><span class="linenos" data-linenos="85 "></span></a><span class="w">            </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><a href="#__codelineno-0-86"><span class="linenos" data-linenos="86 "></span></a><span class="w">                </span><span class="nb">Ok</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{message}&quot;</span><span class="p">),</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><a href="#__codelineno-0-87"><span class="linenos" data-linenos="87 "></span></a><span class="w">                </span><span class="nb">Err</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">eprintln!</span><span class="p">(</span><span class="s">&quot;Problem: {reason}&quot;</span><span class="p">),</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><a href="#__codelineno-0-88"><span class="linenos" data-linenos="88 "></span></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><a href="#__codelineno-0-89"><span class="linenos" data-linenos="89 "></span></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><a href="#__codelineno-0-90"><span class="linenos" data-linenos="90 "></span></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><a href="#__codelineno-0-91"><span class="linenos" data-linenos="91 "></span></a><span class="p">}</span>
</span></code></pre></div>
<p>Phần 1: Lọc Stream</p>
<p><div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="w">   </span>The<span class="w"> </span>value<span class="w"> </span>was:<span class="w"> </span><span class="m">6</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">   </span>The<span class="w"> </span>value<span class="w"> </span>was:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a><span class="w">   </span>The<span class="w"> </span>value<span class="w"> </span>was:<span class="w"> </span><span class="m">12</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">   </span>The<span class="w"> </span>value<span class="w"> </span>was:<span class="w"> </span><span class="m">18</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">   </span>The<span class="w"> </span>value<span class="w"> </span>was:<span class="w"> </span><span class="m">20</span>
</span></code></pre></div>
   * Phân tích: Đây là kết quả của khối đầu tiên. Chương trình tạo một luồng từ [1..10], nhân mỗi số với 2,
     sau đó chỉ giữ lại những số chia hết cho 3 hoặc 5. Kết quả hoàn toàn chính xác.</p>
<p>Phần 2: Nhận Message đơn giản</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a>Message: &#39;a&#39;
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>Message: &#39;b&#39;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>...
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>Message: &#39;j&#39;
</span></code></pre></div>
<ul>
<li>Phân tích: Khối thứ hai chỉ đơn giản là nhận và in ra tất cả các tin nhắn từ hàm get_messages. 10 tin
     nhắn đã được in ra đầy đủ. Hoạt động đúng.</li>
</ul>
<p>Phần 3: Stream với Timeout (dùng Debug {:?})
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a>Message: &#39;a&#39;
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a>Problem: Elapsed(())
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>Message: &#39;c&#39;
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a>Problem: Elapsed(())
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>Message: &#39;e&#39;
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a>...
</span></code></pre></div></p>
<ul>
<li>Phân tích: Khối thứ ba thêm một timeout(200ms).<ul>
<li>Các tin nhắn ở vị trí chẵn ('a', 'c', 'e'...) được gửi sau 100ms, đến kịp trước timeout, nên được
     in ra.</li>
<li>Các tin nhắn ở vị trí lẻ ('b', 'd', 'f'...) được gửi sau 300ms, đến trễ và gây ra lỗi timeout.</li>
<li>Lỗi được in ra là Problem: Elapsed(()). Đây là kết quả của việc dùng {:?} (định dạng Debug) để in
     lỗi. Hoạt động đúng như mong đợi.</li>
</ul>
</li>
</ul>
<p>Phần 4: Gộp (Merge) Stream (dùng Display {})</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a>Interval: 1
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos="2 "></span></a>Message: &#39;a&#39;
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos="3 "></span></a>Interval: 2
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos="4 "></span></a>Interval: 3
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos="5 "></span></a>Problem: deadline has elapsed
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos="6 "></span></a>Interval: 4
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos="7 "></span></a>Message: &#39;b&#39;
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos="8 "></span></a>...
</span></code></pre></div>
<ul>
<li>Phân tích: Đây là khối phức tạp nhất, gộp hai luồng lại với nhau và lấy 20 giá trị đầu tiên (take(20)).<ul>
<li>Bạn có thể thấy các dòng Interval: và Message: được in ra xen kẽ. Điều này cho thấy hàm merge đang
     hoạt động, nó nhận giá trị từ bất kỳ luồng nào có giá trị đến trước.</li>
<li>Các dòng Problem: deadline has elapsed cũng xuất hiện. Đây là lỗi timeout từ luồng messages.</li>
<li>Quan trọng là, dòng lỗi này chính là kết quả của việc dùng {} (định dạng Display) để in lỗi. Nó cho
      ra một chuỗi ký tự khác với Elapsed(()) ở phần 3, đúng như bạn đã nhận xét.</li>
<li>Toàn bộ khối này dừng lại sau khi in ra 20 dòng, chính xác như take(20) đã chỉ định.</li>
</ul>
</li>
</ul>
<p>Tổng kết: Chương trình của bạn đang chạy hoàn hảo và kết quả stdout đã minh họa rất rõ ràng các khái
  niệm về xử lý stream: lọc (filter), timeout, gộp (merge), và giới hạn (take). Phân tích này cũng làm rõ
  sự khác biệt giữa việc in lỗi bằng Debug ({:?}) và Display ({}).</p>
<hr />
<h2 id="ly-thuyet-nen-tang">Lý thuyết nền tảng:<a class="headerlink" href="#ly-thuyet-nen-tang" title="Permanent link">&para;</a></h2>
<ol>
<li>Nền tảng: Xử lý công việc một cách linh hoạt</li>
</ol>
<p>Hãy tưởng tượng một người đầu bếp có thể bắt đầu hầm một nồi súp (một việc tốn nhiều thời gian), và thay
   vì đứng chờ, anh ta có thể quay sang thái rau hoặc chuẩn bị một món khác. Anh ta chỉ quay lại với nồi
  súp khi nó thực sự cần sự chú ý.</p>
<p>Đây là nguyên tắc cơ bản nhất: hệ thống có khả năng thực hiện nhiều công việc đồng thời và xử lý các tác
   vụ một cách hiệu quả mà không bị "đứng hình" chờ đợi.</p>
<ol>
<li>Ý tưởng cốt lõi: Dòng chảy thông tin</li>
</ol>
<p>Thay vì xem dữ liệu như một "hồ nước" tĩnh (một danh sách có sẵn tất cả mọi thứ), hãy hình dung nó như
  một "dòng sông" đang chảy. Thông tin hoặc các sự kiện xuất hiện lần lượt theo thời gian, và chúng ta
  không biết trước tất cả chúng là gì.</p>
<ol>
<li>Các thao tác trên dòng chảy</li>
</ol>
<p>Một khi đã có dòng chảy, chúng ta có thể tác động lên nó theo nhiều cách:</p>
<ul>
<li>Biến đổi: Chúng ta có thể đặt một "nhà máy" trên sông để biến đổi mọi thứ chảy qua nó. Ví dụ, biến
     những khúc gỗ thành những quả bóng gỗ.</li>
<li>Sàng lọc: Chúng ta có thể đặt một "cái lưới" chỉ cho phép những thứ có đặc điểm nhất định (ví dụ, chỉ
     những con cá màu xanh) đi qua và chặn những thứ khác lại.</li>
<li>
<p>Điều tiết: Chúng ta có thể xây một "con đập" để kiểm soát tốc độ của dòng chảy, đảm bảo nó không đến
     quá nhanh gây quá tải cho hệ thống xử lý phía sau.</p>
</li>
<li>
<p>Quản lý yếu tố thời gian</p>
</li>
</ul>
<p>Dòng chảy trong thực tế không phải lúc nào cũng ổn định.</p>
<ul>
<li>
<p>Đặt ra giới hạn thời gian: Chúng ta có thể đặt ra quy tắc: "Tôi chỉ chờ một món đồ trong dòng chảy
     trong một khoảng thời gian nhất định". Nếu nó không đến kịp, ta xem như có "sự cố" và hành động tương
     ứng (ví dụ: bỏ qua và xử lý việc khác) thay vì chờ đợi mãi mãi.</p>
</li>
<li>
<p>Phối hợp nhiều dòng chảy</p>
</li>
</ul>
<p>Hệ thống có thể xử lý nhiều dòng chảy cùng lúc.</p>
<ul>
<li>Hợp nhất: Tưởng tượng có hai dòng sông riêng biệt. Chúng ta có thể đào một con kênh để hợp nhất chúng
     lại thành một dòng sông lớn hơn. Dòng sông mới này sẽ chứa tất cả những gì đến từ hai dòng sông ban
     đầu, theo thứ tự thời gian mà chúng đến.</li>
<li>Giới hạn số lượng: Từ một dòng chảy lớn, chúng ta có thể quyết định rằng mình chỉ cần lấy một số lượng
     vật phẩm nhất định (ví dụ: 20 món đầu tiên) và sẽ không quan tâm đến phần còn lại.</li>
</ul>
<hr />
<p>Tóm lại, toàn bộ bài học này mô tả một hệ thống để:</p>
<blockquote>
<p>Xây dựng các quy trình xử lý thông tin dưới dạng các dòng chảy năng động. Hệ thống này cho phép biến
  đổi, chọn lọc, và điều tiết các dòng chảy đó; xử lý các sự cố về mặt thời gian một cách thông minh; và
  có khả năng phối hợp, hợp nhất nhiều dòng chảy từ các nguồn khác nhau thành một quy trình thống nhất,
  tất cả diễn ra một cách đồng thời và hiệu quả.</p>
</blockquote>
<hr />
<p>Diagram:</p>
<pre class="mermaid"><code>graph TD
    subgraph "Nguồn 1: Người Tạo Tin Nhắn (Chạy ngầm)"
        direction LR
        A1[&lt;B&gt;Task:&lt;/B&gt;&lt;br/&gt;Vòng lặp tạo&lt;br/&gt;'a', 'b', 'c'...] --&gt;|Gửi vào kênh 1| B1((Kênh 1))
    end

    subgraph "Nguồn 2: Người Tạo Nhịp Đếm (Chạy ngầm)"
        direction LR
        A2[&lt;B&gt;Task:&lt;/B&gt;&lt;br/&gt;Vòng lặp đếm&lt;br/&gt;1, 2, 3...] --&gt;|Gửi vào kênh 2| B2((Kênh 2))
    end

    B1 --&gt; C1{"Dòng chảy Tin Nhắn"}
    B2 --&gt; C2{"Dòng chảy Nhịp Đếm"}

    subgraph "Đường ống xử lý Tin Nhắn"
        C1 --&gt; D1["&lt;B&gt;Đặt Giới Hạn Thời Gian&lt;/B&gt;&lt;br/&gt;(Timeout 200ms)"]
    end

    subgraph "Đường ống xử lý Nhịp Đếm"
        C2 --&gt; D2["&lt;B&gt;Biến Đổi&lt;/B&gt;&lt;br/&gt;(Số thành chữ)"] --&gt; E2["&lt;B&gt;Điều Tiết Tốc Độ&lt;/B&gt;&lt;br/&gt;(Throttle 100ms)"] --&gt; F2["&lt;B&gt;Đặt Giới Hạn Thời Gian&lt;/B&gt;&lt;br/&gt;(Timeout 10s)"]
    end

    %% ⚠️ Dòng trống giúp parser không nối liền các node
    D1 --&gt; G{"&lt;B&gt;HỢP NHẤT&lt;/B&gt;&lt;br/&gt;(Merge)"}

    F2 --&gt; G

    G --&gt; H["&lt;B&gt;Giới Hạn Số Lượng&lt;/B&gt;&lt;br/&gt;(Chỉ lấy 20 món đầu tiên)"]

    H --&gt; I([&lt;B&gt;Người Tiêu Dùng Cuối Cùng&lt;/B&gt;&lt;br/&gt;Vòng lặp in kết quả ra màn hình])

    %% Styling
    style A1 fill:#f9f,stroke:#333,stroke-width:2px
    style A2 fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#ffc,stroke:#333,stroke-width:4px
    style I fill:#9af9,stroke:#333,stroke-width:2px
</code></pre>
<h2 id="merge-hop-nhat-hoat-ong-cac-luong-stream"><code>merge</code> (hợp nhất) hoạt động các luồng <code>stream</code>.<a class="headerlink" href="#merge-hop-nhat-hoat-ong-cac-luong-stream" title="Permanent link">&para;</a></h2>
<p>Hãy tưởng tượng merge như một nhân viên trực tổng đài đang theo dõi hai đường dây điện thoại cùng một
  lúc:
   * Đường dây 1: Luồng messages.
   * Đường dây 2: Luồng intervals.</p>
<p>Luồng được hợp nhất (<code>merged</code>) là chuỗi các cuộc gọi mà nhân viên này xử lý.</p>
<h3 id="1-luon-lang-nghe-ca-hai-nguon-cung-luc">1. Luôn lắng nghe cả hai nguồn cùng lúc<a class="headerlink" href="#1-luon-lang-nghe-ca-hai-nguon-cung-luc" title="Permanent link">&para;</a></h3>
<p>Nhân viên trực tổng đài không bao giờ chỉ nghe một đường dây và bỏ mặc đường dây kia. Anh ta đặt cả hai
  ống nghe lên tai và lắng nghe đồng thời. Bất kỳ đường dây nào có tín hiệu đến trước (item được tạo ra),
  anh ta sẽ xử lý ngay lập-tức.</p>
<p>Đây là bản chất của merge: nó "chạy đua" (races) hai luồng nguồn với nhau trong cùng một thời điểm.</p>
<h3 id="2-ai-en-truoc-phuc-vu-truoc-first-come-first-served">2. "Ai đến trước, phục vụ trước" (First-Come, First-Served)<a class="headerlink" href="#2-ai-en-truoc-phuc-vu-truoc-first-come-first-served" title="Permanent link">&para;</a></h3>
<p>Thứ tự các giá trị trong luồng merged không được sắp xếp xen kẽ (một từ <code>messages</code>, một từ <code>intervals</code>, rồi
  lại một từ <code>messages</code>...). Thay vào đó, thứ tự được quyết định hoàn toàn bởi thời gian.</p>
<p>Hãy xem lại kết quả của bạn:</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>Interval:<span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="o">(</span>Luồng<span class="w"> </span>intervals<span class="w"> </span>nhanh<span class="w"> </span>hơn<span class="o">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos="2 "></span></a>Message:<span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w">  </span><span class="o">(</span>Luồng<span class="w"> </span>messages<span class="w"> </span>đến<span class="w"> </span>kịp<span class="w"> </span>ngay<span class="w"> </span>sau<span class="w"> </span>đó<span class="o">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos="3 "></span></a>Interval:<span class="w"> </span><span class="m">2</span><span class="w">   </span><span class="o">(</span>Luồng<span class="w"> </span>intervals<span class="w"> </span>lại<span class="w"> </span>nhanh<span class="w"> </span>hơn<span class="o">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos="4 "></span></a>Interval:<span class="w"> </span><span class="m">3</span><span class="w">   </span><span class="o">(</span>Lại<span class="w"> </span>là<span class="w"> </span>intervals,<span class="w"> </span>vì<span class="w"> </span>nó<span class="w"> </span>đều<span class="w"> </span>đặn<span class="w"> </span>100ms<span class="o">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos="5 "></span></a>Problem:<span class="w"> </span>...<span class="w">  </span><span class="o">(</span>Lỗi<span class="w"> </span>timeout<span class="w"> </span>từ<span class="w"> </span>luồng<span class="w"> </span>messages<span class="o">)</span>
</span></code></pre></div>
<p>Điều này cho thấy <code>intervals</code> có vẻ tạo ra giá trị rất nhanh và đều đặn, trong khi messages có tốc độ thất
  thường hơn (lúc 100ms, lúc 300ms nên bị timeout). Luồng merged chỉ đơn giản là thu thập và chuyển tiếp bất cứ thứ gì đến tai nó trước.</p>
<h3 id="3-cung-loai-du-lieu">3. Cùng loại dữ liệu<a class="headerlink" href="#3-cung-loai-du-lieu" title="Permanent link">&para;</a></h3>
<p>Một quy tắc quan trọng: để hợp nhất, cả hai luồng nguồn phải tạo ra cùng một "kiểu" dữ liệu. Trong mã
  của bạn, cả hai luồng sau khi biến đổi đều tạo ra <code>Result&lt;String, ...&gt;</code> (một chuỗi ký tự hoặc một lỗi). Vì
   chúng cùng kiểu, merge có thể hoạt động. Bạn không thể hợp nhất một luồng số nguyên với một luồng chuỗi
   ký tự một cách trực tiếp.</p>
<h3 id="4-khi-nao-thi-ket-thuc">4. Khi nào thì kết thúc?<a class="headerlink" href="#4-khi-nao-thi-ket-thuc" title="Permanent link">&para;</a></h3>
<p>Bình thường, luồng merged chỉ kết thúc khi cả hai luồng nguồn (messages và intervals) đều đã kết thúc.
  Tuy nhiên, trong mã của bạn có thêm <code>.take(20)</code>, nó giống như một chỉ thị cho nhân viên tổng đài: "Sau khi anh xử lý đủ 20 cuộc gọi (bất kể từ đường dây nào), hãy dừng công việc và gác máy".</p>
<p>Mục đích và ứng dụng</p>
<p>Tóm lại, merge là công cụ để tổng hợp các sự kiện từ nhiều nguồn không đồng bộ vào một kênh xử lý duy
  nhất. Nó cực kỳ hữu ích trong các ứng dụng thực tế, ví dụ:</p>
<ul>
<li>Trong một giao diện người dùng, bạn có thể hợp nhất một luồng các cú nhấp chuột của người dùng với một
     luồng dữ liệu đến từ máy chủ.</li>
<li>Trong một hệ thống giao dịch, bạn có thể hợp nhất các cập nhật giá từ nhiều sàn giao dịch khác nhau vào
      một luồng để phân tích.</li>
</ul>
<p>Nó cho phép bạn phản ứng với các sự kiện ngay khi chúng xảy ra, bất kể chúng đến từ đâu.</p>
<h2 id="spawn_task-trong-ma-la-gi"><code>spawn_task</code> trong mã là gì?<a class="headerlink" href="#spawn_task-trong-ma-la-gi" title="Permanent link">&para;</a></h2>
<p><code>spawn_task</code> là một khái niệm cực kỳ quan trọng trong lập trình không đồng bộ, và nó đóng vai trò trung tâm trong việc tạo ra các "dòng chảy" trong mã của bạn.</p>
<p>Hãy xem xét nó một cách chi tiết.</p>
<p><code>spawn_task</code> là gì?</p>
<p>Nói một cách đơn giản, <code>spawn_task</code> có nghĩa là: "Hãy bắt đầu công việc này, nhưng đừng chờ nó hoàn thành.
   Hãy để nó chạy ngầm trong khi chúng ta tiếp tục làm việc khác."</p>
<p>Nó giống như bạn giao việc cho một nhân viên. Bạn không đứng kè kè bên cạnh xem họ làm, mà bạn tin tưởng
   họ sẽ tự hoàn thành công việc đó. Trong khi họ làm, bạn có thể đi giải quyết các vấn-đề khác.</p>
<p>Vai trò trong mã của bạn: Tạo ra "Người sản xuất"</p>
<p>Trong cả hai hàm <code>get_messages</code> và <code>get_intervals</code>, <code>spawn_task</code> được sử dụng để tạo ra một "Người sản-xuất"
  (Producer) chạy ở chế độ nền.</p>
<p>Hãy phân tích quy trình trong hàm <code>get_messages</code>:</p>
<ol>
<li>
<p>Tạo kênh liên lạc:
      <code>let (tx, rx) = trpl::channel();</code>
      Đầu tiên, một "kênh liên lạc" được tạo ra. Kênh này có 2 đầu:</p>
<ul>
<li>tx (Transmitter): Đầu để gửi dữ liệu đi.</li>
<li>rx (Receiver): Đầu để nhận dữ liệu đến.</li>
</ul>
</li>
<li>
<p>Giao nhiệm vụ chạy ngầm:
      <code>trpl::spawn_task(async move { ... });</code>
      Đây chính là lúc bạn "giao việc". Bạn nói với hệ thống: "Hãy lấy khối công việc async này và chạy nó
   trên một luồng riêng. Khối công việc này sẽ giữ đầu gửi <code>tx</code>."</p>
</li>
<li>
<p>Công việc của "Người sản xuất":
      Bên trong khối <code>async</code>, có một vòng lặp liên tục tạo ra các tin nhắn và gửi chúng vào kênh thông qua
  <code>tx.send(...)</code>. Nhiệm vụ này chạy hoàn toàn độc lập. Nó không biết ai đang nhận tin, nó chỉ biết gửi tin
  vào kênh.</p>
</li>
<li>
<p>Trả về "Người tiêu dùng":
      <code>ReceiverStream::new(rx)</code>
      Trong khi nhiệm vụ chạy ngầm đang bận rộn sản xuất tin nhắn, hàm <code>get_messages</code> ngay lập tức trả về
  đầu nhận rx (được gói lại thành một Stream). Bất kỳ ai gọi hàm <code>get_messages</code> sẽ nhận được "thuê bao" này
  để bắt đầu lắng nghe tin nhắn.</p>
</li>
</ol>
<p>Tại sao phải làm vậy?</p>
<p>Đây là câu hỏi quan trọng nhất. Tại sao không đặt vòng lặp tạo tin nhắn trực tiếp trong hàm <code>get_messages</code>?</p>
<p>Nếu bạn làm vậy, hàm get_messages sẽ phải chạy hết toàn bộ vòng lặp, tạo ra tất cả các tin nhắn, lưu chúng
  vào một danh sách, rồi mới trả về danh sách đó. Điều này có hai vấn đề lớn:</p>
<ol>
<li>Làm block chương trình: Hàm sẽ bị "kẹt" lại cho đến khi tạo xong tin nhắn cuối cùng.</li>
<li>Phá vỡ ý tưởng "dòng chảy": Bạn sẽ nhận được một hồ nước (tất cả dữ liệu cùng lúc), chứ không phải một
      dòng sông (dữ liệu đến từ từ theo thời gian).</li>
</ol>
<p>Bằng cách sử dụng spawn_task, bạn cho phép việc sản xuất dữ liệu (chạy ngầm) và việc tiêu thụ dữ liệu
  (vòng lặp while let trong main) diễn ra song song và độc lập. Chúng chỉ giao tiếp với nhau qua một kênh.
   Điều này tạo ra một dòng chảy dữ liệu thực sự, hiệu quả và không gây tắc nghẽn.</p>
<h2 id="giai-thich-ky-hon-ve-impl-stream-va-receiverstream">Giải thích kỹ hơn về impl Stream<T> và ReceiverStream<T><a class="headerlink" href="#giai-thich-ky-hon-ve-impl-stream-va-receiverstream" title="Permanent link">&para;</a></h2>
<p>✦ Chắc chắn rồi. Đây là hai khái niệm có liên quan mật thiết, một cái là trừu tượng (cái giao diện), một cái
   là cụ thể (cái thực thi).</p>
<p>Hãy phân tích từng cái một.</p>
<ol>
<li><code>impl Stream&lt;Item = T&gt;</code>: Lời hứa về một "Dòng chảy"</li>
</ol>
<p>Khi bạn thấy <code>impl Stream&lt;...&gt;</code> ở vị trí trả về của một hàm, hãy đọc nó như một "lời hứa".</p>
<p><code>fn get_messages() -&gt; impl Stream&lt;Item = String&gt;</code></p>
<p>Lời hứa này có nghĩa là:</p>
<blockquote>
<p>"Tôi, hàm get_messages, hứa sẽ trả về cho bạn một thứ gì đó. Tôi không nói chính xác nó là kiểu dữ
  liệu gì, nhưng tôi đảm bảo nó sẽ hoạt động giống hệt như một Stream (dòng chảy), và các phần tử trong
  dòng chảy đó sẽ là kiểu String."</p>
</blockquote>
<p>Tại sao lại cần lời hứa này?</p>
<ol>
<li>
<p>Che giấu sự phức tạp: Khi bạn gọi nhiều phương thức xử lý stream nối tiếp nhau
      <code>(.map().filter().take()...)</code>, kiểu dữ liệu thực tế ở cuối cùng sẽ trở nên cực kỳ dài và phức tạp (ví dụ:
       <code>Take&lt;Filter&lt;Map&lt;...&gt;&gt;&gt;)</code>. Dùng <code>impl Stream</code> giúp bạn giữ cho tên hàm được gọn gàng, chỉ cần nói ra hành
      vi ("đây là một dòng chảy") thay vì cấu trúc cụ thể của nó.</p>
</li>
<li>
<p>Tăng tính linh hoạt: Người viết hàm get_messages có thể thay đổi hoàn toàn cách họ tạo ra stream ở bên
      trong. Miễn là thứ cuối cùng họ trả về vẫn giữ đúng lời hứa (vẫn là một Stream chứa String), thì code ở
       bên ngoài (trong hàm main) sẽ không bị ảnh hưởng và không cần thay đổi gì cả.</p>
</li>
</ol>
<p>Tóm lại: <code>impl Stream&lt;T&gt;</code> là một cách nói trừu tượng, tập trung vào chức năng ("bạn có thể làm gì với
  nó?") thay vì chi tiết kỹ thuật ("nó được làm từ gì?").</p>
<hr />
<ol>
<li><code>ReceiverStream&lt;T&gt;</code>: Một loại "Dòng chảy" cụ thể</li>
</ol>
<p>Nếu impl Stream là một lời hứa, thì <code>ReceiverStream</code> là một trong những cách để thực hiện lời hứa đó.</p>
<p>Đây là một kiểu dữ liệu cụ thể (struct). Tên của nó đã mô tả chính xác chức năng của nó: "Một <code>Stream</code>
  được tạo ra từ một <code>Receiver</code> (đầu nhận của kênh)."</p>
<p>Vai trò: Bộ chuyển đổi (Adapter)</p>
<p>Nhiệm vụ chính của <code>ReceiverStream</code> là làm một cây cầu nối, một bộ chuyển đổi. Nó biến một đầu nhận rx của
   kênh liên lạc (vốn chỉ là một cái ống để chờ dữ liệu) thành một Stream đúng nghĩa, thứ mà bạn có thể xử
   lý, biến đổi, hợp nhất...</p>
<p>Cách hoạt động (về mặt ý tưởng):</p>
<ol>
<li>ReceiverStream "bọc" lấy đầu nhận rx.</li>
<li>Khi bạn gọi <code>.next().await</code> trên <code>ReceiverStream</code>, nó sẽ thực hiện thao tác <code>rx.recv().await</code> ở bên trong.
      Tức là nó sẽ chờ cho đến khi có dữ liệu được gửi đến đầu rx của kênh.</li>
<li>Khi nhận được dữ liệu, nó sẽ trả ra cho bạn.</li>
</ol>
<p>Mối liên hệ giữa hai khái niệm</p>
<p>Bây giờ hãy kết nối chúng lại trong hàm get_messages:</p>
<div class="language-rust highlight"><span class="filename">Rust</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="w">   </span><span class="k">fn</span><span class="w"> </span><span class="nf">get_messages</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Lời hứa</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trpl</span><span class="p">::</span><span class="n">channel</span><span class="p">();</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">        </span><span class="n">trpl</span><span class="p">::</span><span class="n">spawn_task</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos="5 "></span></a><span class="w">            </span><span class="c1">// ... gửi dữ liệu vào tx ...</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos="6 "></span></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos="7 "></span></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos="8 "></span></a><span class="w">        </span><span class="n">ReceiverStream</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span><span class="w"> </span><span class="c1">// Cách thực hiện lời hứa cụ thể</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos="9 "></span></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<ol>
<li>Bên trong hàm, một <code>ReceiverStream</code> cụ thể được tạo ra.</li>
<li>Khi trả về, Rust thấy rằng <code>ReceiverStream</code> đúng là một loại <code>Stream</code>, nên lời hứa <code>impl Stream</code> được thỏa
      mãn.</li>
<li>Hàm main khi nhận được kết quả, nó không cần biết đó là ReceiverStream. Nó chỉ biết rằng đó là một <code>impl
       Stream</code> và nó có thể gọi <code>.next().await</code> trên đó.</li>
</ol>
<p>Đây là một nguyên tắc thiết kế phần mềm rất mạnh mẽ: "Lập trình dựa trên giao diện (hành vi), không phải dựa trên thực thi cụ thể."</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../19_smart_pointers/cow1/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Cow (Clone-on-Write) trong Rust">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Cow (Clone-on-Write) trong Rust
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Do Huy Hoang
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.follow", "toc.integrate", "navigation.footer", "navigation.top", "navigation.tabs", "navigation.path"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../javascripts/mermaid.mjs" type="module"></script>
      
    
  </body>
</html>